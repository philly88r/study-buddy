{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Blog Generator</h1>

        <!-- Keywords Input -->
        <div class="mb-8">
            <label for="keywords" class="block text-sm font-medium text-gray-700 mb-2">
                Enter Keywords (one per line)
            </label>
            <textarea
                id="keywords"
                rows="10"
                class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"
                placeholder="Enter your keywords here...&#10;Example:&#10;best study techniques&#10;how to improve memory&#10;effective note-taking methods"></textarea>
        </div>

        <!-- Generate Button -->
        <button
            onclick="generateBlogs()"
            class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition duration-300">
            Generate Blog Posts
        </button>

        <!-- Loading State -->
        <div id="loading" class="hidden mt-4">
            <div class="flex items-center space-x-2">
                <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600"></div>
                <span class="text-gray-600">Generating blog posts...</span>
            </div>
        </div>

        <!-- Results -->
        <div id="results" class="mt-8 space-y-4 hidden">
            <h2 class="text-2xl font-semibold mb-4">Generated Blog Posts</h2>
            <div id="blogList" class="space-y-4">
                <!-- Blog posts will be inserted here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function generateBlogs() {
    const keywordsText = document.getElementById('keywords').value;
    const keywords = keywordsText.split('\n').filter(k => k.trim());
    
    if (keywords.length === 0) {
        alert('Please enter at least one keyword');
        return;
    }

    // Show loading state
    document.getElementById('loading').classList.remove('hidden');
    document.getElementById('results').classList.add('hidden');

    try {
        const response = await fetch('/blog/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ keywords })
        });

        const data = await response.json();

        if (response.ok) {
            displayResults(data.blog_posts);
        } else {
            throw new Error(data.error || 'Failed to generate blog posts');
        }
    } catch (error) {
        alert('Error: ' + error.message);
    } finally {
        document.getElementById('loading').classList.add('hidden');
    }
}

function displayResults(blogPosts) {
    const blogList = document.getElementById('blogList');
    blogList.innerHTML = '';

    blogPosts.forEach(post => {
        const blogCard = document.createElement('div');
        blogCard.className = 'bg-white p-6 rounded-lg shadow-lg';
        blogCard.innerHTML = `
            <h3 class="text-xl font-semibold mb-2">${post.title}</h3>
            <a href="/blog/${post.slug}" 
               class="text-indigo-600 hover:text-indigo-800 hover:underline">
                View Blog Post
            </a>
        `;
        blogList.appendChild(blogCard);
    });

    document.getElementById('results').classList.remove('hidden');
}
</script>
{% endblock %}
